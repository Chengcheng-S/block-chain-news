## JVM && coretime
JAM(Join Accumulate Machine)

[波卡 2.0 的野望：重构与连通 - Foresight News](https://foresightnews.pro/article/detail/50814)

[graypaper.pdf](https://graypaper.com/graypaper.pdf).  jam 灰皮书

[Polkadot's JAM Chain · Polkadot Wiki](https://wiki.polkadot.network/docs/learn-jam-chain)[Polkadot's JAM Chain · Polkadot Wiki](https://wiki.polkadot.network/docs/learn-jam-chain)

作为polkadot 2.0 JAM将只处理来自平行链、智能合约等行为者的工作。简言之就是负责结算的工作。
而 Polkadot 2.0 更进一步，它提供了`无服务器`解决方案。开发者不再需要担心服务器。应用程序可以根据请求在云中的某个地方运行。同样，受到共享安全性的保护。

JAM (Just Another Machine):
- JAM 是 Polkadot 生态系统中的一个关键概念。
  它旨在探索去中心化应用程序的新前景。

- 核心 JAM 提供了技术基础，使人们能够轻松启动 Web3 应用程序。

- 它通过`分片`和`扩展技术`增强了区块链的能力。

- JAM 的目标是`降低对特定技术的依赖`，使系统更加通用和灵活。

  

  Coretime:

- Coretime 是 Polkadot 生态系统中的另一个重要概念。

- 它是一个 `时间同步协议`，旨在解决区块链中的`时间问题`。

- 区块链中的时间同步对于确保交易的顺序和一致性至关重要。

- Coretime 旨在提供高度准确的时间戳，以支持区块链的正常运行。

在 **Polkadot** 中继链上执行验证和共识所需的时间（共享安全性）。它是波卡网络中最稀缺的资源。

1.0 则是通过插槽拍卖/租赁，来获取relay Chain 验证的。

在2.0 中则是可流动、可交易、可累积的资源。它可以用来购买或出售区块时间。

**Coretime** 的收益可能会进入国库再分配，由 **DOT** 持有人决定如何处理。这可以用于资助波卡生态中的项目，或者选择销毁 **Coretime** 收入来降低通胀。

> 这是一种可以通过DOT/KSM代币购买的链上资源，允许平行链在持续的时间内连接到中继链同时让即时付费应用也能接入Polkadot中继链。该核心时间模型分为即时和批量两种购买模式。值得注意的是，批量核心时间可以作为 NFT 在二级市场进行交易，这样将大大增强计算资源的市场灵活性。



#### 从计算资源的角度看到Polkadot2.0

* 区块空间（BlockSpace）（底层通过区块链技术实现），而不是区块链
* **构建应用程序的平台**而不是区块链，以供人们来使用这些去中心化应用程序。从根本上说，Polkadot 并不是一个托管链的平台。
* **弹性通用连续计算服务的供应商**，
* 多核计算机，其中在不同内核上连续并行运行的链是 称为平行链。目前一条链预留一个核心 通过 插槽拍卖机制接入。

polkadot 2.0 范式转变：

* 从一个以链为中心的生态系统，其中每个平行链始终拥有一个执行核心 （通过固定的平行链插槽获得），实现了简单且安全的分片执行环境
* 转变成为一个以`去中心化应用程序为中心的生态系统`，摒弃每个应用程序固定占用一个核心，而采用所有核心可以根据需要`消耗和使用`的`资源`为每个应用程序服务。

协议（Accord）将改善跨链通信和保障XCM消息的安全。最后， Polkadot 2.0 通过将原本中继链上的涉及业务有关的逻辑移至其系统平行链来进行扩展，从而使其拥有更多平行链和协议（Accord）的带宽。

**从以链为中心到以应用为中心**

> **中继链将处理越来越少的任务。**中继链将仅集中精力在其主要的任务：保护网络并提供安全的消息传递能力。系统平行链将用于接管辅助中继链完成质押、账户管理、治理等任务。

#### XCM && Accord

> **协议**是一项多链可以*选择性加入的*条约，其中条约逻辑无法改变或被一条或多条链破坏，Polkadot 保证忠实执行这一逻辑。协议将针对特定功能，任何进入协议的链都将被纳入该特定的功能。为了降低进入门槛，可以无需许可的方式提出协议。

SPREE 技术用来具体实现协议的功能。



### Polkadot 2.0的弹性

如果一个区块链系统未在设计时充分考虑到去中心化、密码学和博弈论等各方面的因素， 那么必然该系统是脆弱且容易受到网络攻击的。Polkadot 2.0 强大的弹性机制主要基于以下几大支柱：

- **轻客户端使用占主导地位**：中心化集中式 RPC 服务器很常见，但容易受到影响攻击。Polkadot 上的客户端可以通过 Smoldot 以完全去中心化的方式访问Polkadot网络。
- **零知识 (ZK) 原语**：它们可能会对审查制度和中心化世界里产生一些法律问题，因为将大型状态转换函数归结为正确执行的单一证明目前并不是构建可扩展弹性系统的解决方案。然而，一个功能丰富、高性能的 ZK 原语库正在构建中，为特定用例做好准备。第一个用例将用于改善 Polkadot 技术奖学金等链上集体的隐私。
- **Sassafras 共识算法**：[SASSAFRAS | Research at Web3 Foundation](https://research.web3.foundation/Polkadot/protocols/block-production/SASSAFRAS) 参考zk-snark的出块算法，它使用 SNARK 专门用于其匿名功能。它提供恒定时间的区块生产，几乎完全无分叉。  新的无分叉区块生产共识算法以替换BABE，除非交易预计最终被确定，否则不会生成区块。这将带来几个好处，例如：
  - 通过无分叉提高了安全性、平行链性能和用户体验
  - 通过高性能交易路由（交易只需经过一跳就被包含在区块中而不是在网络节点中进行广播）和交易加密来防止抢先交易攻击。
  - **节点间 Mixnet**：短消息的屏蔽传输
  - 避免泄露交易的 IP 信息
  - 引入了一个通用消息传递系统，允许用户、链和链下任务、智能合约、pallet和链中存在的任何其他东西交换包含签名的消息等。
- **社会去中心化**：通过让更多的参与者做出贡献来实现弹性系统并通过链上治理做出决策。让尽可能多的人参与，可以确保支出不会出现系统性误判，并适当引导国库用于支出工资和赏金。网络去中心化的另一个重要方法是确保系统维护所依赖的专家，随着时间的推移，是由受到 Polkadot 网络而不是 Polkadot 生态系统内的任何组织来激励和招募。



JAM 服务的代码分为三个不同的入口点：

- Refine 是执行大部分无状态计算的函数。它为特定服务的 rollup 定义转换。
- Accumulate 函数获取输出并将其折叠到服务的整体状态中
- OnTransfer 处理来自其他服务的信息。



**Transactionless**

JAM 的安全装置包括两阶段处理，其中 Refine 函数接受工作项作为输入，并产生工作结果作为输出，然后进入 Accumulate 函数（先 Refine，后 Accumulate）。

JAM 通过无交易（Transactionless）操作来区别于智能合约链。JAM 内没有交易；所有动作都是无需许可的，并且最初会经历 Refine 阶段。在这个阶段，服务预先细化输入数据，将其转换为包含工作结果的工作报告。随后，这些工作结果被传送到链上。

JAM 仍然接受特定格式的外部信息。有五种类型的外部信息：

* Guarantees
* Assurances
* Judgments
* Preimages
* Tickets

**Refine**

Refine 是主要的处理主力，处理大部分是无状态操作的任务。

**Accumlate**

Accumulate 函数负责将 Refine 函数生成的输出整合到链状态中。

与 Refine 不同，Accumulate 是有状态的，它可以访问 JAM 链的状态。它可以从任何服务读取存储，写入其键值存储，Refine 可以调用 PVM 的子实例。

**OnTransfer**

JAM 系统中的 onTransfer 函数也是有状态的，使其能够修改服务的状态。它具有检查其他服务状态并修改自身状态的能力。这一功能促进了服务之间的通信，尽管是以异步方式进行的。

**Polkadot 虚拟机（PVM）**

PVM 的设计基于 RISC-V 指令集架构（ISA）

* 易于转译成常见的硬件格式，如 x86、x64 和 ARM。
* 得到LLVM等工具的支持。

RISC-V 通过将堆栈放置在内存中来解决这个问题，从而自然地促进连续处理，而无需增加复杂性。

WASM 虽然针对 Web 用例进行了优化，但也给**堆栈管理**带来了挑战，特别是在处理连续性方面。

PVM 在传统硬件上运行时，尤其是在 X64 和 ARM 上，展示了卓越的执行速度，提供了免费计量等优势，这与 WASM 相比具有优势。

**SAFROLE**

SAFROLE 是一个区块生产算法，简化了 SASSAFRAS。

SAFROLE 是一个基于 SNARK 的区块生产算法。它使用 SNARK 是因为其匿名特性。并且它提供几乎完全无分叉的恒定时间区块生产。可能发生分叉的几个实例基本上只有在出现网络分裂或有人故意恶意操作时才会发生。匿名的巨大价值不是为了保持验证者身份的秘密；实际上，当他们产生一个区块时，他们无论如何都会暴露自己的身份，这么做其实是为了确保区块生产机制本身的安全，基本上是为了避免垃圾交易攻击。

**network**

JAM 的网络使用 QUIC 协议。这允许在大量验证者之间直接建立点对点连接。不必担心可能的套接字问题。

**高效的区块处理**

在类似以太坊这样的基于状态的区块链中，**区块的头通常包含后状态根**，总结了所有区块计算后的状态。因此，直到所有计算完成之前，块头不能发送。但是，可以在发送块头之前执行一些计算，因为它们的结果决定了区块的有效性。

而在JAM中，将前状态根放在区块头中，而不是后状态根。这意味着标题中显示的状态根比一个区块延迟。因此，可以执行大约占区块工作量或执行时间 5% 的轻量级计算，并可以立即分发区块。其余 95% 的区块计算，主要是 Accumulate 任务，可以随后完成。这使得在执行当前区块之前可以开始下一个区块。

**与relay chain的区别**

JAM 通过其服务模型保留了与中继链中的 WebAssembly 元协议，将可升级性责任转移到服务上，使链本身免于承担升级的负担。

1. 优先考虑简单性。维护不可升级的链显著减少了复杂性。
2. 中继链倾向于引入复杂的功能，而不删除旧的功能，这使得事情变得复杂。由于升级容易实现，因此几乎没有简化 Substrate SDK 的动机。因此，复制 Polkadot 变得不切实际。
3. JAM 的固定参数提供了优化潜力。通过清楚地了解 JAM 链必须执行的特定任务和能够设置固定参数，网络拓扑和时序等领域的优化变得可行。这与中继链高度可升级的本质形成对比，在那里，由于每次升级都可能进行频繁的更改，因此这些优化更复杂。

**JAM Toaster**

用于进行大规模试验和性能评估的测试平台。
